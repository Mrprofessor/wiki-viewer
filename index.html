<!DOCTYPE html>
<html>
<head>
	<title>Wikipedia viewer</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div class="container">
		<div class="row justify-content-center" id="searchBox">
			<div class="col-md-8 text-center">
				<h1 class="text-muted">Fakepedia</h1>
				<div class="input-group">
  					<input id="query" type="text" class="form-control" placeholder="What do you wanna know ?"
  					aria-label="query" aria-describedby="basic-addon2">
  					<span class="input-group-button" id="basic-addon2">
  						<button id="searchBtn" class="btn btn-info">Search here</button>
  					</span>
				</div>
			</div>
		</div>
		<div id="results"></div>
	</div>
</body>
<script type="text/javascript">
	var query = document.querySelector("#query"),
		btn   = document.querySelector("#searchBtn");
		
	//HandleKeyPressEvent
	document.querySelector("#query").addEventListener("keyup", event => {
    	if(event.key !== "Enter") return; // Use `.key` instead.
    	btn.click(); // Things you want to do.
    	event.preventDefault(); // No need to `return false;`.
	});
	//HandleButtonPressEvent
	btn.addEventListener("click", function(){
		console.log(query.value);
		getArticles(query.value);
	});

	//Fetch data
	function getArticles(query){
		var url ="http://en.wikipedia.org/w/api.php?origin=*&action=query&format=json&list=search&srsearch=";
		url  += query ;
		fetch(url) 
			.then(function(response){
				return response.json();
			})
			.then(function(data){
				iterateData(data);					//showData() called
			})
			.catch(function() {
				console.log("Something really bad has happened.");
			});
	}

	//Show data
	function iterateData(data) {
		var articles = data.query.search;
		for(var article of articles) {
			showData(article.title, article.snippet, article.pageid);
			console.log(article.title);
		}
		// console.log(data.query.search);
	}

	function showData(title, text, id) {
		var str = 
		'<div class="card text-center">\
		  		<div class="card-body">\
		    		<h4 class="card-title">'+title+'</h4>\
		    		<p class="card-text text-muted">'+text+'</p>\
		  		</div>\
		  		<div class="card-footer">\
		    		<a href="https://en.wikipedia.org/?curid='+id+'"\
		    		class="btn btn-info btn-sm" target="blank">see for yourself\
		    		</a>\
		  		</div>\
			</div>\
		</div>';

		append(str, '.container');
	}



	// Append function
	function append(elString, parent) {
		var div = document.createElement("div");
		div.innerHTML = elString;
		document.querySelector(parent || "body").appendChild(div.firstChild);
}

</script>
</html>

